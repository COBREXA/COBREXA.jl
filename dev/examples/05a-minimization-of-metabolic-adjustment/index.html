<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Minimization of metabolic adjustment analysis · COBREXA.jl</title><meta name="title" content="Minimization of metabolic adjustment analysis · COBREXA.jl"/><meta property="og:title" content="Minimization of metabolic adjustment analysis · COBREXA.jl"/><meta property="twitter:title" content="Minimization of metabolic adjustment analysis · COBREXA.jl"/><meta name="description" content="Documentation for COBREXA.jl."/><meta property="og:description" content="Documentation for COBREXA.jl."/><meta property="twitter:description" content="Documentation for COBREXA.jl."/><meta property="og:url" content="https://cobrexa.github.io/COBREXA.jl/stable/examples/05a-minimization-of-metabolic-adjustment/"/><meta property="twitter:url" content="https://cobrexa.github.io/COBREXA.jl/stable/examples/05a-minimization-of-metabolic-adjustment/"/><link rel="canonical" href="https://cobrexa.github.io/COBREXA.jl/stable/examples/05a-minimization-of-metabolic-adjustment/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="COBREXA.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="COBREXA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">COBREXA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../">Contents</a></li><li><a class="tocitem" href="../01-loading-and-saving/">Loading and saving models</a></li><li><a class="tocitem" href="../02a-flux-balance-analysis/">Flux balance analysis (FBA)</a></li><li><a class="tocitem" href="../02b-optimizer-parameters/">Changing optimizer parameters</a></li><li><a class="tocitem" href="../02c-model-modifications/">Making adjustments to the model</a></li><li><a class="tocitem" href="../02d-constraint-modifications/">Making adjustments to the constraint system</a></li><li><a class="tocitem" href="../03a-flux-variability-analysis/">Flux variability analysis (FVA)</a></li><li><a class="tocitem" href="../03b-parsimonious-flux-balance/">Parsimonious flux balance analysis</a></li><li><a class="tocitem" href="../03c-envelopes/">Production envelopes</a></li><li><a class="tocitem" href="../04-community-models/">Community FBA models</a></li><li class="is-active"><a class="tocitem" href>Minimization of metabolic adjustment analysis</a><ul class="internal"><li><a class="tocitem" href="#Finding-parsimonious-solutions"><span>Finding parsimonious solutions</span></a></li><li><a class="tocitem" href="#Comparing-the-results"><span>Comparing the results</span></a></li><li><a class="tocitem" href="#Using-a-custom-reference-flux"><span>Using a custom reference flux</span></a></li><li><a class="tocitem" href="#Efficient-linear-metric-MOMA"><span>Efficient linear-metric MOMA</span></a></li></ul></li><li><a class="tocitem" href="../05b-enzyme-constrained-models/">Enzyme constrained models</a></li><li><a class="tocitem" href="../05c-mmdf/">Thermodynamic models</a></li><li><a class="tocitem" href="../05d-loopless-models/">Loopless flux balance analysis (ll-FBA)</a></li><li><a class="tocitem" href="../05e-knockouts/">Gene knockouts</a></li><li><a class="tocitem" href="../05f-cyclefree/">CycleFreeFlux</a></li><li><a class="tocitem" href="../05g-gapfilling/">Gap filling</a></li><li><a class="tocitem" href="../06a-sampling/">Flux sampling</a></li><li><a class="tocitem" href="../06b-screening/">Screening through many model variants</a></li></ul></li><li><a class="tocitem" href="../../structure/">Core concepts and structure</a></li><li><span class="tocitem">Parallel, distributed and HPC processing</span><ul><li><a class="tocitem" href="../../distributed/">Contents</a></li><li><a class="tocitem" href="../../distributed/1_functions/">Parallel processing overview</a></li><li><a class="tocitem" href="../../distributed/2_parallel/">Local parallel processing</a></li><li><a class="tocitem" href="../../distributed/3_slurm/">Working in a HPC environment</a></li></ul></li><li><span class="tocitem">API reference</span><ul><li><a class="tocitem" href="../../reference/">Contents</a></li><li><a class="tocitem" href="../../reference/analysis/">Specialized analysis functions</a></li><li><a class="tocitem" href="../../reference/builders/">Constraint system builders</a></li><li><a class="tocitem" href="../../reference/core/">Core functionality</a></li><li><a class="tocitem" href="../../reference/frontend/">Front-end user interface</a></li><li><a class="tocitem" href="../../reference/misc/">Miscellaneous functions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Minimization of metabolic adjustment analysis</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Minimization of metabolic adjustment analysis</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/COBREXA/COBREXA.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/COBREXA/COBREXA.jl/blob/master/docs/src/examples/05a-minimization-of-metabolic-adjustment.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Minimization-of-metabolic-adjustment-analysis"><a class="docs-heading-anchor" href="#Minimization-of-metabolic-adjustment-analysis">Minimization of metabolic adjustment analysis</a><a id="Minimization-of-metabolic-adjustment-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Minimization-of-metabolic-adjustment-analysis" title="Permalink"></a></h1><p>Minimization of metabolic adjustment analysis (MOMA) finds a flux solution that is closest to some reference solution. This may correspond to realistic adjustment of living organisms to various perturbations, such as gene knockout or environmental stress.</p><p>To demonstrate, let&#39;s use the E. coli model.</p><pre><code class="language-julia hljs">using COBREXA

download_model(
    &quot;http://bigg.ucsd.edu/static/models/e_coli_core.json&quot;,
    &quot;e_coli_core.json&quot;,
    &quot;7bedec10576cfe935b19218dc881f3fb14f890a1871448fc19a9b4ee15b448d8&quot;,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;e_coli_core.json&quot;</code></pre><p>We shall use both quadratic and linear solvers – the &quot;closest to some reference solution&quot; typically refers to Euclidean (&quot;L2&quot;) distance which requires a QP solver, but Manhattan (&quot;L1&quot;) distance is also demonstrated below.</p><pre><code class="language-julia hljs">import Clarabel, HiGHS</code></pre><p>Because we will have to perform some perturbation, we import the model in canonical Julia structures:</p><pre><code class="language-julia hljs">import JSONFBCModels
import AbstractFBCModels.CanonicalModel as CM
ecoli = load_model(&quot;e_coli_core.json&quot;, CM.Model)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AbstractFBCModels.CanonicalModel.Model(
  reactions = Dict{String, AbstractFBCModels.CanonicalModel.Reaction}(&quot;ACALD&quot; =…
  metabolites = Dict{String, AbstractFBCModels.CanonicalModel.Metabolite}(&quot;glu_…
  genes = Dict{String, AbstractFBCModels.CanonicalModel.Gene}(&quot;b4301&quot; =&gt; Abstra…
  couplings = Dict{String, AbstractFBCModels.CanonicalModel.Coupling}(),
)
</code></pre><p>This will be a good reaction for perturbing:</p><pre><code class="language-julia hljs">ecoli.reactions[&quot;CYTBD&quot;]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">AbstractFBCModels.CanonicalModel.Reaction(
  name = &quot;Cytochrome oxidase bd (ubiquinol-8: 2 protons)&quot;,
  lower_bound = 0.0,
  upper_bound = 1000.0,
  stoichiometry = Dict(&quot;h2o_c&quot; =&gt; 1.0, &quot;o2_c&quot; =&gt; -0.5, &quot;h_e&quot; =&gt; 2.0, &quot;q8_c&quot; =&gt; …
  objective_coefficient = 0.0,
  gene_association_dnf = [[&quot;b0733&quot;, &quot;b0734&quot;], [&quot;b0978&quot;, &quot;b0979&quot;]],
  annotations = Dict(&quot;metanetx.reaction&quot; =&gt; [&quot;MNXR97031&quot;], &quot;sbo&quot; =&gt; [&quot;SBO:00001…
  notes = Dict(&quot;original_bigg_ids&quot; =&gt; [&quot;CYTBD&quot;]),
)
</code></pre><p>To do the perturbation, we create a model of a strain which has mild issues with running the CYTBD reaction. We use <code>deepcopy</code> to completely avoid any reference sharing issues.</p><pre><code class="language-julia hljs">limited_ecoli = deepcopy(ecoli)
limited_ecoli.reactions[&quot;CYTBD&quot;].upper_bound = 10.0</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">10.0</code></pre><h2 id="Finding-parsimonious-solutions"><a class="docs-heading-anchor" href="#Finding-parsimonious-solutions">Finding parsimonious solutions</a><a id="Finding-parsimonious-solutions-1"></a><a class="docs-heading-anchor-permalink" href="#Finding-parsimonious-solutions" title="Permalink"></a></h2><p>Becuase we are interested in realistic flux distributions, we have to use an analysis method which gives one – in this case, the parsimonious FBA will do just right. For later comparison, we first get the optimal parsimonious flux distribution in the perturbed model:</p><pre><code class="language-julia hljs">solution = parsimonious_flux_balance_analysis(limited_ecoli, optimizer = Clarabel.Optimizer)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Tree{Float64} with 5 elements:
  :coupling               =&gt; ConstraintTrees.Tree{Float64}(#= 0 elements =#)
  :flux_stoichiometry     =&gt; ConstraintTrees.Tree{Float64}(#= 72 elements =#)
  :fluxes                 =&gt; ConstraintTrees.Tree{Float64}(#= 95 elements =#)
  :objective              =&gt; 0.391648
  :parsimonious_objective =&gt; 5087.91</code></pre><p>Now, how much is the flux going to differ if we assume the bacterium did only minimal adjustment from the previous state with unlimited CYTBD?</p><pre><code class="language-julia hljs">moma_solution = metabolic_adjustment_minimization_analysis(
    limited_ecoli, # the model to be examined
    ecoli; # the model that gives the reference flux
    optimizer = Clarabel.Optimizer,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Tree{Float64} with 5 elements:
  :coupling                     =&gt; ConstraintTrees.Tree{Float64}(#= 0 elements …
  :flux_stoichiometry           =&gt; ConstraintTrees.Tree{Float64}(#= 72 elements…
  :fluxes                       =&gt; ConstraintTrees.Tree{Float64}(#= 95 elements…
  :minimal_adjustment_objective =&gt; 4937.56
  :objective                    =&gt; 0.241497</code></pre><h2 id="Comparing-the-results"><a class="docs-heading-anchor" href="#Comparing-the-results">Comparing the results</a><a id="Comparing-the-results-1"></a><a class="docs-heading-anchor-permalink" href="#Comparing-the-results" title="Permalink"></a></h2><p>The difference between the naive and minimally-adjusting solutions can be extracted using the constraint tree functionality:</p><pre><code class="language-julia hljs">import ConstraintTrees as C
difference = C.zip(-, solution, moma_solution, Float64)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Tree{Float64} with 4 elements:
  :coupling           =&gt; ConstraintTrees.Tree{Float64}(#= 0 elements =#)
  :flux_stoichiometry =&gt; ConstraintTrees.Tree{Float64}(#= 72 elements =#)
  :fluxes             =&gt; ConstraintTrees.Tree{Float64}(#= 95 elements =#)
  :objective          =&gt; 0.150152</code></pre><pre><code class="language-julia hljs">sort(collect(difference.fluxes), by = last)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">95-element Vector{Pair{Symbol, Union{Float64, ConstraintTrees.Tree{Float64}}}}:
      :FORt =&gt; -15.937900590627708
  :EX_h2o_e =&gt; -12.25973750482275
      :ACKr =&gt; -12.23112377824434
     :ACt2r =&gt; -12.231123778242587
       :PDH =&gt; -10.669672606178668
  :EX_co2_e =&gt; -9.924850036343367
    :ATPS4r =&gt; -8.655939529984154
       :PPC =&gt; -4.689341153719435
      :FRD7 =&gt; -4.073826730909896
 :EX_etoh_e =&gt; -3.727116982395617
            ⋮
     :ACALD =&gt; 5.6514793889087
      :THD2 =&gt; 6.71524350812716
      :CO2t =&gt; 9.924850036343452
   :EX_ac_e =&gt; 12.231123778242294
      :PTAr =&gt; 12.231123778252899
      :H2Ot =&gt; 12.259737504822999
  :EX_for_e =&gt; 15.937900592298138
       :PFL =&gt; 15.937900592299496
    :EX_h_e =&gt; 20.94183649468959</code></pre><h2 id="Using-a-custom-reference-flux"><a class="docs-heading-anchor" href="#Using-a-custom-reference-flux">Using a custom reference flux</a><a id="Using-a-custom-reference-flux-1"></a><a class="docs-heading-anchor-permalink" href="#Using-a-custom-reference-flux" title="Permalink"></a></h2><p>In certain situations, one might want to examine how the model would adjust from a known reaction flux. We can supply it manually as the second argument (instead of the reference model).</p><pre><code class="language-julia hljs">ref = parsimonious_flux_balance_analysis(ecoli, optimizer = Clarabel.Optimizer)

ref_closest_solution = metabolic_adjustment_minimization_analysis(
    limited_ecoli,
    ref.fluxes;
    optimizer = Clarabel.Optimizer,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Tree{Float64} with 5 elements:
  :coupling                     =&gt; ConstraintTrees.Tree{Float64}(#= 0 elements …
  :flux_stoichiometry           =&gt; ConstraintTrees.Tree{Float64}(#= 72 elements…
  :fluxes                       =&gt; ConstraintTrees.Tree{Float64}(#= 95 elements…
  :minimal_adjustment_objective =&gt; 4937.56
  :objective                    =&gt; 0.241497</code></pre><p>The flux may even be partial (which is common with measured fluxes):</p><pre><code class="language-julia hljs">measured_fluxes =
    C.Tree{Float64}(:EX_ac_e =&gt; 5.0, :EX_o2_e =&gt; -2.0, :BIOMASS_Ecoli_core_w_GAM =&gt; 0.7)

solution_close_to_measurement = metabolic_adjustment_minimization_analysis(
    limited_ecoli,
    measured_fluxes;
    optimizer = Clarabel.Optimizer,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Tree{Float64} with 5 elements:
  :coupling                     =&gt; ConstraintTrees.Tree{Float64}(#= 0 elements …
  :flux_stoichiometry           =&gt; ConstraintTrees.Tree{Float64}(#= 72 elements…
  :fluxes                       =&gt; ConstraintTrees.Tree{Float64}(#= 95 elements…
  :minimal_adjustment_objective =&gt; 0.183188
  :objective                    =&gt; 0.272247</code></pre><h2 id="Efficient-linear-metric-MOMA"><a class="docs-heading-anchor" href="#Efficient-linear-metric-MOMA">Efficient linear-metric MOMA</a><a id="Efficient-linear-metric-MOMA-1"></a><a class="docs-heading-anchor-permalink" href="#Efficient-linear-metric-MOMA" title="Permalink"></a></h2><p>The linear version of MOMA avoids having to use the quadratic optimizer in the process, giving more optimizer choices and (typically) much better performance. Linear MOMA has the same interface as the quadratic one:</p><pre><code class="language-julia hljs">linear_moma_solution = linear_metabolic_adjustment_minimization_analysis(
    limited_ecoli,
    ecoli;
    optimizer = HiGHS.Optimizer,
)

sort(collect(linear_moma_solution.fluxes), by = last)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">95-element Vector{Pair{Symbol, Union{Float64, ConstraintTrees.Tree{Float64}}}}:
         :PGK =&gt; -15.434651933306435
         :PGM =&gt; -15.106655803899905
        :H2Ot =&gt; -11.54994054300062
        :CO2t =&gt; -8.778386666898754
 :EX_glc__D_e =&gt; -8.322012190986193
       :ACALD =&gt; -5.755385239519781
      :ALCD2x =&gt; -5.755385239519781
     :ETOHt2r =&gt; -5.755385239519781
     :EX_o2_e =&gt; -5.0
    :EX_nh4_e =&gt; -3.664419001773459
              ⋮
    :EX_co2_e =&gt; 8.778386666898754
         :PDH =&gt; 9.282532599166617
       :CYTBD =&gt; 10.0
    :EX_h2o_e =&gt; 11.54994054300062
      :NADH16 =&gt; 11.99204468413819
      :ATPS4r =&gt; 12.020451381843891
      :EX_h_e =&gt; 13.32001812519156
         :ENO =&gt; 15.106655803899905
        :GAPD =&gt; 15.434651933306435</code></pre><p>How much does the flux distribution differ from the L2 solution?</p><pre><code class="language-julia hljs">sort(
    collect(C.zip(-, linear_moma_solution.fluxes, moma_solution.fluxes, Float64)),
    by = last,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">95-element Vector{Pair{Symbol, Union{Float64, ConstraintTrees.Tree{Float64}}}}:
        :GAPD =&gt; -2.217421474277627
         :ENO =&gt; -2.1841385417330486
        :FRD7 =&gt; -2.0818742855029964
  :EX_acald_e =&gt; -1.9243624065292773
      :EX_h_e =&gt; -1.7636376825707192
         :PDH =&gt; -1.3871400070221949
      :GLCpts =&gt; -1.1700704237440558
      :SUCCt3 =&gt; -1.0914174611276102
   :EX_succ_e =&gt; -1.0914174609219507
      :NADH16 =&gt; -1.0914174606140925
              ⋮
        :CO2t =&gt; 0.4467050816544056
        :H2Ot =&gt; 1.046555418943509
         :FUM =&gt; 1.0914174606586302
         :MDH =&gt; 1.0914174620392267
 :EX_glc__D_e =&gt; 1.1700704237440576
       :ACALD =&gt; 1.7125013840399266
      :ACALDt =&gt; 1.9243624065292788
         :PGM =&gt; 2.184138541733045
         :PGK =&gt; 2.2174214742776375</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../04-community-models/">« Community FBA models</a><a class="docs-footer-nextpage" href="../05b-enzyme-constrained-models/">Enzyme constrained models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Wednesday 16 October 2024 18:05">Wednesday 16 October 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
