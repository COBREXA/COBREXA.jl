<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Community FBA models · COBREXA.jl</title><meta name="title" content="Community FBA models · COBREXA.jl"/><meta property="og:title" content="Community FBA models · COBREXA.jl"/><meta property="twitter:title" content="Community FBA models · COBREXA.jl"/><meta name="description" content="Documentation for COBREXA.jl."/><meta property="og:description" content="Documentation for COBREXA.jl."/><meta property="twitter:description" content="Documentation for COBREXA.jl."/><meta property="og:url" content="https://cobrexa.github.io/COBREXA.jl/stable/examples/08-community-models/"/><meta property="twitter:url" content="https://cobrexa.github.io/COBREXA.jl/stable/examples/08-community-models/"/><link rel="canonical" href="https://cobrexa.github.io/COBREXA.jl/stable/examples/08-community-models/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="COBREXA.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="COBREXA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">COBREXA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../">Contents</a></li><li><a class="tocitem" href="../01-loading-and-saving/">Loading and saving models!</a></li><li><a class="tocitem" href="../02-flux-balance-analysis/">Flux balance analysis (FBA)</a></li><li><a class="tocitem" href="../02a-optimizer-parameters/">Changing optimizer parameters</a></li><li><a class="tocitem" href="../02b-model-modifications/">Making adjustments to the model</a></li><li><a class="tocitem" href="../02c-constraint-modifications/">Making adjustments to the constraint system</a></li><li><a class="tocitem" href="../03-parsimonious-flux-balance/">Parsimonious flux balance analysis</a></li><li><a class="tocitem" href="../04-minimization-of-metabolic-adjustment/">Minimization of metabolic adjustment analysis</a></li><li><a class="tocitem" href="../05-enzyme-constrained-models/">Enzyme constrained models</a></li><li><a class="tocitem" href="../06-mmdf/">Thermodynamic models</a></li><li><a class="tocitem" href="../07-loopless-models/">Loopless flux balance analysis (ll-FBA)</a></li><li class="is-active"><a class="tocitem" href>Community FBA models</a><ul class="internal"><li><a class="tocitem" href="#Building-a-community-of-two-*E.-coli*s"><span>Building a community of two <em>E. coli</em>s</span></a></li></ul></li></ul></li><li><span class="tocitem">Parallel, distributed and HPC processing</span><ul><li><a class="tocitem" href="../../distributed/">Contents</a></li><li><a class="tocitem" href="../../distributed/1_functions/">Parallel processing overview</a></li><li><a class="tocitem" href="../../distributed/2_parallel/">Local parallel processing</a></li><li><a class="tocitem" href="../../distributed/3_slurm/">Working in a HPC environment</a></li></ul></li><li><span class="tocitem">Core concepts guide</span><ul><li><a class="tocitem" href="../../concepts/">Contents</a></li><li><a class="tocitem" href="../../concepts/1_screen/">Screening many model variants</a></li></ul></li><li><span class="tocitem">API reference</span><ul><li><a class="tocitem" href="../../reference/">Contents</a></li><li><a class="tocitem" href="../../reference/analysis/">Specialized analysis functions</a></li><li><a class="tocitem" href="../../reference/builders/">Constraint system builders</a></li><li><a class="tocitem" href="../../reference/core/">Core functionality</a></li><li><a class="tocitem" href="../../reference/frontend/">Front-end user interface</a></li><li><a class="tocitem" href="../../reference/misc/">Miscellaneous functions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Community FBA models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Community FBA models</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/COBREXA/COBREXA.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/COBREXA/COBREXA.jl/blob/master/docs/src/examples/08-community-models.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Community-FBA-models"><a class="docs-heading-anchor" href="#Community-FBA-models">Community FBA models</a><a id="Community-FBA-models-1"></a><a class="docs-heading-anchor-permalink" href="#Community-FBA-models" title="Permalink"></a></h1><pre><code class="language-julia hljs">using COBREXA</code></pre><p>Here we will construct a community FBA model of two  <em>E. coli</em> &quot;core&quot; models that can interact by exchanging selected metabolites. To do this, we will need the model, which we can download if it is not already present.</p><pre><code class="language-julia hljs">import Downloads: download

!isfile(&quot;e_coli_core.json&quot;) &amp;&amp;
    download(&quot;http://bigg.ucsd.edu/static/models/e_coli_core.json&quot;, &quot;e_coli_core.json&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">false</code></pre><p>Additionally to COBREXA and the model format package, we will need a solver – let&#39;s use GLPK here:</p><pre><code class="language-julia hljs">import JSONFBCModels
import GLPK
import ConstraintTrees as C

model = load_model(&quot;e_coli_core.json&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">JSONFBCModels.JSONFBCModel(#= 95 reactions, 72 metabolites =#)</code></pre><p>Community models work by joining its members together through their exchange reactions, weighted by the abundance of each microbe. These exchange reactions are then linked to an environmental exchange. For more theoretical details, see &quot;Gottstein, et al, 2016, Constraint-based stoichiometric modelling from single organisms to microbial communities, Journal of the Royal Society Interface&quot;.</p><h2 id="Building-a-community-of-two-*E.-coli*s"><a class="docs-heading-anchor" href="#Building-a-community-of-two-*E.-coli*s">Building a community of two <em>E. coli</em>s</a><a id="Building-a-community-of-two-*E.-coli*s-1"></a><a class="docs-heading-anchor-permalink" href="#Building-a-community-of-two-*E.-coli*s" title="Permalink"></a></h2><p>Here we will construct a simple community of two interacting microbes. To do this, we need to import the models. We will represent the models only as constraint trees, because it is easier to build the model explicitly than rely on an opaque one-shot function.</p><pre><code class="language-julia hljs">ecoli1 = flux_balance_constraints(model, interface = :sbo)
ecoli2 = flux_balance_constraints(model, interface = :sbo)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Tree{ConstraintTrees.Constraint} with 4 elements:
  :flux_stoichiometry =&gt; ConstraintTrees.Tree{ConstraintTrees.Constraint}(#= 72…
  :fluxes             =&gt; ConstraintTrees.Tree{ConstraintTrees.Constraint}(#= 95…
  :interface          =&gt; ConstraintTrees.Tree{ConstraintTrees.Constraint}(#= 2 …
  :objective          =&gt; ConstraintTrees.Constraint(ConstraintTrees.LinearValue…</code></pre><p>Since the models are usually used in a mono-culture context, the glucose input for each individual member is limited. We need to undo this limitation, and rather rely on the constrained environmental exchange reaction (and the bounds we set for it earlier).</p><pre><code class="language-julia hljs">ecoli1.fluxes.EX_glc__D_e.bound = C.Between(-1000.0, 1000.0)
ecoli2.fluxes.EX_glc__D_e.bound = C.Between(-1000.0, 1000.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Between(-1000.0, 1000.0)</code></pre><p>To make the community interesting, we can limit different reactions in both members to see how the  models cope together:</p><pre><code class="language-julia hljs">ecoli1.fluxes.CYTBD.bound = C.Between(-10.0, 10.0)
ecoli2.fluxes.ACALD.bound = C.Between(-5.0, 5.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Between(-5.0, 5.0)</code></pre><p>Because we created the trees with interfaces, we can connect them easily to form a new model with the interface. For simplicity, we use the interface-scaling functionality of <a href="../../reference/builders/#COBREXA.interface_constraints-Tuple{Any}"><code>interface_constraints</code></a> to bring in cFBA-like community member abundances:</p><pre><code class="language-julia hljs">cc = interface_constraints(
    :bug1 =&gt; (ecoli1, ecoli1.interface, 0.2),
    :bug2 =&gt; (ecoli2, ecoli2.interface, 0.8),
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Tree{ConstraintTrees.Constraint} with 4 elements:
  :bug1              =&gt; ConstraintTrees.Tree{ConstraintTrees.Constraint}(#= 4 e…
  :bug2              =&gt; ConstraintTrees.Tree{ConstraintTrees.Constraint}(#= 4 e…
  :interface         =&gt; ConstraintTrees.Tree{ConstraintTrees.Constraint}(#= 2 e…
  :interface_balance =&gt; ConstraintTrees.Tree{ConstraintTrees.Constraint}(#= 2 e…</code></pre><p>To make the community behave as expected, we need to force equal (scaled) growth of all members:</p><pre><code class="language-julia hljs">cc *=
    :equal_growth^equal_value_constraint(
        cc.bug1.fluxes.BIOMASS_Ecoli_core_w_GAM,
        cc.bug2.fluxes.BIOMASS_Ecoli_core_w_GAM,
    )</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Tree{ConstraintTrees.Constraint} with 5 elements:
  :bug1              =&gt; ConstraintTrees.Tree{ConstraintTrees.Constraint}(#= 4 e…
  :bug2              =&gt; ConstraintTrees.Tree{ConstraintTrees.Constraint}(#= 4 e…
  :equal_growth      =&gt; ConstraintTrees.Constraint(ConstraintTrees.LinearValue(…
  :interface         =&gt; ConstraintTrees.Tree{ConstraintTrees.Constraint}(#= 2 e…
  :interface_balance =&gt; ConstraintTrees.Tree{ConstraintTrees.Constraint}(#= 2 e…</code></pre><p>Now we can simulate the community growth by optimizing the new &quot;interfaced&quot; biomass:</p><pre><code class="language-julia hljs">optimized_cc = optimized_values(
    cc,
    objective = cc.interface.biomass.BIOMASS_Ecoli_core_w_GAM.value,
    optimizer = GLPK.Optimizer,
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Tree{Float64} with 5 elements:
  :bug1              =&gt; ConstraintTrees.Tree{Float64}(#= 4 elements =#)
  :bug2              =&gt; ConstraintTrees.Tree{Float64}(#= 4 elements =#)
  :equal_growth      =&gt; 0.0
  :interface         =&gt; ConstraintTrees.Tree{Float64}(#= 2 elements =#)
  :interface_balance =&gt; ConstraintTrees.Tree{Float64}(#= 2 elements =#)</code></pre><p>We can now e.g. observe the differences in individual pairs of exchanges:</p><pre><code class="language-julia hljs">C.zip(
    tuple,
    optimized_cc.bug1.interface.exchanges,
    optimized_cc.bug2.interface.exchanges,
    Tuple{Float64,Float64},
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ConstraintTrees.Tree{Tuple{Float64, Float64}} with 20 elements:
  :EX_ac_e     =&gt; (119.498, 340.912)
  :EX_acald_e  =&gt; (0.0, 0.0)
  :EX_akg_e    =&gt; (0.0, 0.0)
  :EX_co2_e    =&gt; (423.72, 49.1276)
  :EX_etoh_e   =&gt; (681.106, 0.0)
  :EX_for_e    =&gt; (561.538, 340.123)
  :EX_fru_e    =&gt; (0.0, 0.0)
  :EX_fum_e    =&gt; (0.0, 2.13163e-14)
  :EX_glc__D_e =&gt; (-543.854, -291.288)
  :EX_gln__L_e =&gt; (0.0, 0.0)
  :EX_glu__L_e =&gt; (-3.55271e-15, 0.0)
  :EX_h2o_e    =&gt; (-141.56, 164.953)
  :EX_h_e      =&gt; (1000.0, 1000.0)
  :EX_lac__D_e =&gt; (0.0, 0.0)
  :EX_mal__L_e =&gt; (0.0, 0.0)
  :EX_nh4_e    =&gt; (-86.7025, -86.7025)
  :EX_o2_e     =&gt; (-5.0, -200.806)
  :EX_pi_e     =&gt; (-58.4933, -58.4933)
  :EX_pyr_e    =&gt; (0.0, 0.0)
  :EX_succ_e   =&gt; (0.0, 0.0)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../07-loopless-models/">« Loopless flux balance analysis (ll-FBA)</a><a class="docs-footer-nextpage" href="../../distributed/">Contents »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Friday 2 February 2024 09:11">Friday 2 February 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
