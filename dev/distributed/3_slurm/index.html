<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Working in a HPC environment · COBREXA.jl</title><meta name="title" content="Working in a HPC environment · COBREXA.jl"/><meta property="og:title" content="Working in a HPC environment · COBREXA.jl"/><meta property="twitter:title" content="Working in a HPC environment · COBREXA.jl"/><meta name="description" content="Documentation for COBREXA.jl."/><meta property="og:description" content="Documentation for COBREXA.jl."/><meta property="twitter:description" content="Documentation for COBREXA.jl."/><meta property="og:url" content="https://cobrexa.github.io/COBREXA.jl/stable/distributed/3_slurm/"/><meta property="twitter:url" content="https://cobrexa.github.io/COBREXA.jl/stable/distributed/3_slurm/"/><link rel="canonical" href="https://cobrexa.github.io/COBREXA.jl/stable/distributed/3_slurm/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="COBREXA.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="COBREXA.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">COBREXA.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/">Contents</a></li><li><a class="tocitem" href="../../examples/01-loading-and-saving/">Loading and saving models</a></li><li><a class="tocitem" href="../../examples/02a-flux-balance-analysis/">Flux balance analysis (FBA)</a></li><li><a class="tocitem" href="../../examples/02b-optimizer-parameters/">Changing optimizer parameters</a></li><li><a class="tocitem" href="../../examples/02c-model-modifications/">Making adjustments to the model</a></li><li><a class="tocitem" href="../../examples/02d-constraint-modifications/">Making adjustments to the constraint system</a></li><li><a class="tocitem" href="../../examples/03a-flux-variability-analysis/">Flux variability analysis (FVA)</a></li><li><a class="tocitem" href="../../examples/03b-parsimonious-flux-balance/">Parsimonious flux balance analysis</a></li><li><a class="tocitem" href="../../examples/03c-envelopes/">Production envelopes</a></li><li><a class="tocitem" href="../../examples/04-community-models/">Community FBA models</a></li><li><a class="tocitem" href="../../examples/05a-minimization-of-metabolic-adjustment/">Minimization of metabolic adjustment analysis</a></li><li><a class="tocitem" href="../../examples/05b-enzyme-constrained-models/">Enzyme constrained models</a></li><li><a class="tocitem" href="../../examples/05c-mmdf/">Thermodynamic models</a></li><li><a class="tocitem" href="../../examples/05d-loopless-models/">Loopless flux balance analysis (ll-FBA)</a></li><li><a class="tocitem" href="../../examples/05e-knockouts/">Gene knockouts</a></li><li><a class="tocitem" href="../../examples/06a-sampling/">Flux sampling</a></li><li><a class="tocitem" href="../../examples/06b-screening/">Screening through many model variants</a></li></ul></li><li><a class="tocitem" href="../../structure/">Core concepts and structure</a></li><li><span class="tocitem">Parallel, distributed and HPC processing</span><ul><li><a class="tocitem" href="../">Contents</a></li><li><a class="tocitem" href="../1_functions/">Parallel processing overview</a></li><li><a class="tocitem" href="../2_parallel/">Local parallel processing</a></li><li class="is-active"><a class="tocitem" href>Working in a HPC environment</a><ul class="internal"><li><a class="tocitem" href="#Interacting-with-Slurm"><span>Interacting with Slurm</span></a></li><li><a class="tocitem" href="#Wrapping-a-pipeline-script-in-a-Slurm-batch-job"><span>Wrapping a pipeline script in a Slurm batch job</span></a></li></ul></li></ul></li><li><span class="tocitem">API reference</span><ul><li><a class="tocitem" href="../../reference/">Contents</a></li><li><a class="tocitem" href="../../reference/analysis/">Specialized analysis functions</a></li><li><a class="tocitem" href="../../reference/builders/">Constraint system builders</a></li><li><a class="tocitem" href="../../reference/core/">Core functionality</a></li><li><a class="tocitem" href="../../reference/frontend/">Front-end user interface</a></li><li><a class="tocitem" href="../../reference/misc/">Miscellaneous functions</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Parallel, distributed and HPC processing</a></li><li class="is-active"><a href>Working in a HPC environment</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Working in a HPC environment</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/COBREXA/COBREXA.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/COBREXA/COBREXA.jl/blob/master/docs/src/distributed/3_slurm.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Working-in-a-HPC-environment"><a class="docs-heading-anchor" href="#Working-in-a-HPC-environment">Working in a HPC environment</a><a id="Working-in-a-HPC-environment-1"></a><a class="docs-heading-anchor-permalink" href="#Working-in-a-HPC-environment" title="Permalink"></a></h1><p>Many researchers have access to institutional HPC facilities that allow time-sharing of the capacity of a large computer cluster between many users. Julia and <code>COBREXA.jl</code> work well within this environment, and the COBREXA analyses usually require only minimal additional customization to be able to find and utilize the resources available from the HPC.</p><p>When executed in a HPC environment, the analysis script must solve several relatively complex tasks:</p><ul><li>It needs to find out how many resources were allocated for the analysis</li><li>It needs to add the remote workers precisely at the allocated places</li></ul><p>Fortunately, the package <a href="https://github.com/JuliaParallel/ClusterManagers.jl"><code>ClusterManagers.jl</code></a> does that for us. For simplicity, here we assume that the HPC is scheduled by <a href="https://slurm.schedmd.com/">Slurm</a>, but other scheduling environments are supported in a very similar way.</p><h2 id="Interacting-with-Slurm"><a class="docs-heading-anchor" href="#Interacting-with-Slurm">Interacting with Slurm</a><a id="Interacting-with-Slurm-1"></a><a class="docs-heading-anchor-permalink" href="#Interacting-with-Slurm" title="Permalink"></a></h2><p>Utilization of the Slurm-provided resources is enabled as follows:</p><ul><li>first, import the <code>ClusterManagers</code> package</li><li>find how many processes to spawn from the environment, typically from <code>SLURM_NTASKS</code> environment variable</li><li>use the function <code>addprocs_slurm</code> to precisely connect to the allocated computational resources</li></ul><p>After adding the Slurm workers, one may continue as if the workers were added using normal <code>addprocs</code> –- typically, we can load the model and (for example) run the <code>flux_variability_analysis</code> as if we would use the <a href="../2_parallel/">local workers</a>.</p><p>The Julia script that does a parallel analysis in a Slurm cluster may look as follows:</p><pre><code class="language-julia hljs">using COBREXA, Distributed, ClusterManagers, GLPK

available_workers = parse(Int, ENV[&quot;SLURM_NTASKS&quot;])

addprocs_slurm(available_workers)

# ... load models, prepare data, etc. ...

results = flux_variability_analysis(..., workers=workers())

# ... save the results into a file ...</code></pre><div class="admonition is-success"><header class="admonition-header">What about the other HPC schedulers?</header><div class="admonition-body"><p><code>ClusterManagers.jl</code> supports many other common HPC scheduling systems, including LFS, Sun Grid, SGE, PBS, and Scyld, in a way almost identical to Slurm. See the <a href="https://github.com/JuliaParallel/ClusterManagers.jl/blob/master/README.md">package documentation</a> for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Using Julia environments with Distributed</header><div class="admonition-body"><p>Sometimes the project configuration is not forwarded to the workers automatically, resulting to package version mismatches and other problems. When utilizing custom project folders (by running Julia with <code>julia --project=...</code>), use the following form of <code>addprocs_slurm</code> instead:</p><pre><code class="language-julia hljs">addprocs_slurm(available_workers, exeflags=`--project=$(Base.active_project())`)</code></pre></div></div><h2 id="Wrapping-a-pipeline-script-in-a-Slurm-batch-job"><a class="docs-heading-anchor" href="#Wrapping-a-pipeline-script-in-a-Slurm-batch-job">Wrapping a pipeline script in a Slurm batch job</a><a id="Wrapping-a-pipeline-script-in-a-Slurm-batch-job-1"></a><a class="docs-heading-anchor-permalink" href="#Wrapping-a-pipeline-script-in-a-Slurm-batch-job" title="Permalink"></a></h2><p>To be able to submit a script for later processing using the <a href="https://slurm.schedmd.com/sbatch.html"><code>sbatch</code> Slurm command</a>, we need to wrap it in a small &quot;batch&quot; script that tells Slurm how many resources the process needs.</p><p>Assuming we have a Julia computation script written down in <code>myJob.jl</code> and saved on the HPC cluster&#39;s access node, the corresponding Slurm batch script (let&#39;s call it <code>myJob.sbatch</code>) may look as follows:</p><pre><code class="language-sh hljs">#!/bin/bash -l
#SBATCH -n 100           # the job will use 100 individual worker processes
#SBATCH -c 1             # each worker will sit on a single CPU
#SBATCH -t 30            # the whole job will take less than 30 minutes
#SBATCH -J myJob         # the name of the job (for own reference)

module load lang/Julia   # add Julia to the environment (this may differ on different clusters and installations!)

julia myJob.jl</code></pre><p>To run the computation, run <code>sbatch myJob.sbatch</code> on the cluster access node. The job will be scheduled and eventually executed. It is possible to watch the output of commands <code>sacct</code> and <code>squeue</code> in the meantime, to see the progress.</p><p>Remember that it is necessary to explicitly save the result of the Julia script computation to files, to be able to retrieve them later. Standard outputs of the jobs are often mangled and/or discarded. If we would still want to collect the standard output of the Julia script, we might need to change the last line of the batch script as follows:</p><pre><code class="language-sh hljs">julia myJob.jl &gt; myJob.log</code></pre><p>...and collect the output from <code>myJob.log</code> later. This is convenient especially if the script prints out various computation details using <code>@info</code> and similar macros.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../2_parallel/">« Local parallel processing</a><a class="docs-footer-nextpage" href="../../reference/">Contents »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Thursday 13 June 2024 07:24">Thursday 13 June 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
